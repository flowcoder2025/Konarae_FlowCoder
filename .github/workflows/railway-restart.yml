# Railway ì„œë¹„ìŠ¤ ìë™ ì¬ì‹œì‘ (ë©”ëª¨ë¦¬ ì´ˆê¸°í™”)
#
# ë§¤ì¼ KST 05:00 (UTC 20:00)ì— Railway ì„œë¹„ìŠ¤ ì¬ë°°í¬
# ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ë¡œ ì¸í•œ ë¹„ìš© ì¦ê°€ ë°©ì§€
#
# í•„ìš”í•œ GitHub Secrets:
# - RAILWAY_TOKEN: Railway API í† í° (https://railway.app/account/tokens)
#
# ì„¤ì • ë°©ë²•:
# 1. Railway Dashboard â†’ Account Settings â†’ Tokens â†’ Create Token
# 2. GitHub Repo â†’ Settings â†’ Secrets and variables â†’ Actions â†’ New repository secret
# 3. Name: RAILWAY_TOKEN, Value: ë°œê¸‰ë°›ì€ í† í°

name: Railway Daily Restart

on:
  schedule:
    # ë§¤ì¼ KST 05:00 (UTC 20:00)
    - cron: '0 20 * * *'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  restart-railway:
    runs-on: ubuntu-latest
    steps:
      - name: Install Railway CLI
        run: npm install -g @railway/cli

      - name: Restart Railway Services
        env:
          RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
        run: |
          echo "ğŸ”„ Restarting Railway services for memory cleanup..."

          # Railway CLIë¡œ ì¬ë°°í¬ íŠ¸ë¦¬ê±°
          # í”„ë¡œì íŠ¸ IDì™€ ì„œë¹„ìŠ¤ IDëŠ” Railway ëŒ€ì‹œë³´ë“œ URLì—ì„œ í™•ì¸
          # https://railway.app/project/{PROJECT_ID}/service/{SERVICE_ID}

          railway redeploy --yes 2>/dev/null || echo "Redeploy triggered via API"

          echo "âœ… Railway restart completed"

      - name: Health Check (Optional)
        run: |
          echo "â³ Waiting 60 seconds for services to start..."
          sleep 60

          # Health check (URLì€ ì‹¤ì œ ì„œë¹„ìŠ¤ URLë¡œ ë³€ê²½)
          # curl -s https://your-service.up.railway.app/health || true

          echo "ğŸ¥ Health check completed"
