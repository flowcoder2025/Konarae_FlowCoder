# Railway Configuration for Crawler Worker
# https://docs.railway.app/deploy/config-as-code

[build]
builder = "NIXPACKS"
# Skip Next.js build - worker only needs dependencies installed
nixpacksConfigPath = "nixpacks.toml"

[deploy]
# WORKER_TYPE 환경변수로 워커 타입 선택:
# - crawler (기본값): Crawler Worker
# - embedding: Embedding Worker
startCommand = "if [ \"$WORKER_TYPE\" = \"embedding\" ]; then pnpm run worker:embedding; else pnpm run worker:crawler; fi"
healthcheckPath = "/health"
healthcheckTimeout = 30
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

[env]
# Node.js 환경 설정
NODE_ENV = "production"

# Railway가 자동으로 PORT 환경변수 제공
# 추가 환경변수는 Railway Dashboard에서 설정:
#
# [필수 - 데이터베이스]
# - DATABASE_URL (Prisma 연결, pgbouncer 포함)
# - DIRECT_URL (마이그레이션용 직접 연결)
#
# [필수 - Supabase Storage]
# - NEXT_PUBLIC_SUPABASE_URL (예: https://xxx.supabase.co)
# - SUPABASE_SERVICE_KEY (Service Role Key, 서버 전용)
#
# [필수 - AI/API]
# - GOOGLE_GENERATIVE_AI_API_KEY (Gemini Vision)
# - OPENAI_API_KEY (임베딩 생성)
#
# [필수 - 보안]
# - WORKER_API_KEY (워커 인증)
#
# [필수 - Text Parser (Railway 내부 네트워킹)]
# - TEXT_PARSER_URL=http://text_parser.railway.internal
